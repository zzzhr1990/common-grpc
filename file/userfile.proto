syntax = "proto3";

package services;

//import "service_one/messages.proto";
option go_package = "github.com/zzzhr1990/common-grpc/go/services/file/userfile";
import "common/common_entity.proto";


service UserFileService {
    // rpc createUser (GrpcUser) returns (BoolEntity) {}
    // rpc getUser (Uint64Entity) returns (GrpcUser) {}
    rpc create (UserFile) returns (UserFile) {}
    rpc get (UserFile) returns (UserFile) {}
    rpc uploadToken (UserFile) returns (UploadTokenResponse) {}
    rpc getOrEmpty (UserFile) returns (UserFile) {}
    rpc getOrEmptyEx (UserFile) returns (UserFileEx) {}
    rpc pageDirectory (PageUserFileRequest) returns (UserFilePage) {}
    rpc listDirectory (ListUserFileRequest) returns (UserFileList) {}
    rpc listDirectoryInteral (ListUserFileRequest) returns (UserFileList) {}
    rpc operate (UserFileOperation) returns (Int32Entity) {}
    rpc deleteByIdentity (DeleteFilesRequest) returns (Int64Entity) {}
    rpc moveToTrash (UserFile) returns (Int64Entity) {}
    rpc listTrash (ListTrashRequest) returns (TrashList) {}
    rpc pageTrash (PageTrashRequest) returns (TrashPage) {}
    rpc uploadCallback(StringEntity) returns (UserFile) {}
    rpc tryCreateFile(UserFile) returns (UserFile) {}
    rpc rename (UserFile) returns (BoolEntity) {}
    rpc moveFromTrash (MoveBackRequest) returns (Int32Entity) {}
    // rpc login (GrpcUser) returns (GrpcUser) {}
}

message MoveBackRequest {
    UserFile destination = 1;
    repeated string source = 2;
    int64 userIdentity = 3;
}

message UserFile {
    string identity = 1;
    string hash = 2;
    int64 userIdentity = 3;
    string path = 4;
    string name = 5;
    string ext = 6;
    uint64 size = 7;
    string  parent = 8;
    int32 type = 9;
    bool directory = 10;
    int64 atime = 11;
    int64 ctime = 12;
    int64 mtime = 13;
    uint32  version = 14;
    bool locking = 15;
    uint32 op = 16;
    // bool ignoreCase = 17;
    repeated UserFile children = 17;
}

message UserFileEx {
    string identity = 1;
    string hash = 2;
    int64 userIdentity = 3;
    string path = 4;
    string name = 5;
    string ext = 6;
    uint64 size = 7;
    string  parent = 8;
    int32 type = 9;
    bool directory = 10;
    int64 atime = 11;
    int64 ctime = 12;
    int64 mtime = 13;
    uint32  version = 14;
    bool locking = 15;
    uint32 op = 16;
    // bool ignoreCase = 17;
    repeated UserFile children = 17;
    string downloadAddress = 18;
}

message UserFileOperation {
    repeated UserFile source = 1;
    UserFile destination = 2;
    int32 operationCode = 3;
    int64 userIdentity = 4;
}

message UserFilePage {
    UserFile parent = 1;
    repeated UserFile list = 2;
    int64 totalCount = 3;
    int32 totalPage = 4;
    int32 page = 5;
    int32 pageSize = 6;
}

message DeleteFilesRequest {
    int64 userIdentity = 1;
    repeated string filesIdentity = 2;
}

message UserFileList {
    UserFile parent = 1;
    repeated UserFile list = 2;
    // int64 totalCount = 3;
    // int32 totalPage = 4;
    // int32 page = 5;
    // int32 pageSize = 6;
}

message TrashInfo {
    string identity = 1;
    string name = 2;
    string source = 3;
    uint64 size = 4;
    int64 moveTime = 5;
}

message TrashList {
    repeated TrashInfo list = 1;
    // int64 totalCount = 3;
    // int32 totalPage = 4;
    // int32 page = 5;
    // int32 pageSize = 6;
}


message TrashPage {
    repeated TrashInfo list = 1;
    int64 totalCount = 2;
    int32 totalPage = 3;
    int32 page = 4;
    int32 pageSize = 5;
}

message PageTrashRequest {
    int64 userIdentity = 1;
    int32 orderBy = 2;
    int32 page = 3;
    int32 pageSize = 4;
}

message PageUserFileRequest {
    string identity = 1;
    string path = 2;
    int64 userIdentity = 3;
    //bool ignoreCase = 4;
    int32 orderBy = 4;
    int32 page = 5;
    int32 pageSize = 6;
    int32 filter = 7;
}

message ListUserFileRequest {
    string identity = 1;
    string path = 2;
    int64 userIdentity = 3;
    // bool ignoreCase = 4;
    int32 orderBy = 4;
    int32 start = 5;
    int32 listSize = 6;
    int32 filter = 7;
}

message ListTrashRequest {
    int64 userIdentity = 1;
    int32 orderBy = 2;
    int32 start = 6;
    int32 listSize = 7;
}

message UploadTokenResponse {
    string uploadToken = 1;
    string type = 2;
    string uploadUrl = 3;
    string filePath = 4;
}